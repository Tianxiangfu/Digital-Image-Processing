# 实验三

本次实验实现了两个主要功能：  
1. **基于cGAN的语义图像到真实图像生成**：利用条件生成对抗网络（cGAN），将语义分割图转换为高保真的真实图像。  
2. **复现DragGAN项目**：实现了对图像中特定区域（如人脸特征）的交互式调整，生成符合用户需求的变形图像。



## 目录
- [实验三](#实验三)
  - [目录](#目录)
  - [概述](#概述)
  - [安装步骤](#安装步骤)
    - [1. 条件生成对抗网络（cGAN）项目](#1-条件生成对抗网络cgan项目)
    - [2. DragGAN 项目](#2-draggan-项目)
  - [使用方法](#使用方法)
  - [模型建立](#模型建立)
    - [1. 条件生成对抗网络（cGAN）模型](#1-条件生成对抗网络cgan模型)
    - [2. DragGAN 模型](#2-draggan-模型)
  - [实验结果](#实验结果)


## 概述

本项目围绕生成对抗网络（GAN）技术，结合神经网络的最新进展，展示了图像生成与交互式变形的核心应用。用户可以通过Gradio界面上传输入数据，实时生成高质量图像或对其内容进行直观调整。

项目主要实现以下内容：  
1. **条件生成对抗网络（cGAN）**：通过深度卷积神经网络（DCNN）构建生成器与判别器，实现从语义分割图生成逼真的高分辨率图像，展现GAN在图像生成领域的能力。  
2. **基于GAN的交互式变形（DragGAN）**：利用神经网络的潜在空间建模技术，结合用户输入的点控制信息，动态调整图像的特定区域，实现精细化和个性化变形。  

本项目展示了生成对抗网络与深度神经网络在图像处理领域的巨大潜力，并提供了用户友好型的交互体验。


## 安装步骤

要在本地运行该项目，请按照以下步骤进行：

### 1. 条件生成对抗网络（cGAN）项目


1. 安装所需依赖：
    ```bash
    pip install -r requirements.txt
    ```

2. 下载所需的训练数据集：
    ```bash
    bash download_facades_dataset.sh
    ```

3. 运行训练脚本以训练cGAN模型并生成图片：
    ```bash
    python train.py
    ```

### 2. DragGAN 项目


1. 创建虚拟环境并安装所需库：
    ```bash
    conda env create -f environment.yml
    conda activate stylegan3
    ```

2. 下载所需的训练模型：
    ```bash
    scripts\download_model.bat
    ```

3. 在linux系统下运行DragGAN交互界面：
    ```bash
    sh scripts/gui.sh
    ```

## 使用方法

1. **cGAN**：
   - 运行 `train.py` 开始训练模型
   - 模型将通过输入语义图像并输出真实图像的方式来验证结果

2. **DragGAN**：
   - 运行 `scripts/gui.sh` 启动DragGAN工具。
   - 上传一张人脸图像，选择stylegan2-ffhq模型运行，也可以选择其他提供的模型。
   - 选择图像，并在图像上选择特定控制点，拖动这些点调整人脸特征。


## 模型建立

本实验的模型建立环节包括以下两个部分：

### 1. 条件生成对抗网络（cGAN）模型
- **生成器**：生成器接收条件图像和随机噪声作为输入，通过全连接层逐步扩展特征维度。首先将条件图像和噪声展平并拼接，经过多层全连接层和ReLU激活，最后通过Tanh激活函数输出生成的图像。
- **判别器**：判别器接收条件图像和待判别的目标图像作为输入，首先将它们在通道维度拼接为6通道输入。通过多层卷积层提取特征，并使用Leaky ReLU激活函数处理特征。最终，经过两层全连接层和Sigmoid激活函数，输出一个概率值，表示目标图像的真实性。
- **损失函数**：结合生成对抗损失（GAN Loss）和像素级别的L1损失，确保生成图像在视觉上逼真并与输入的语义分割图一致。

为了加强生成器，削弱判别器，采用每两个batch更新一次判别器参数，并将生成器的learning rate调高

### 2. DragGAN 模型

- **潜在空间建模**：DragGAN通过GAN的潜在空间生成真实图像，并采用预训练模型作为基础。  
- **交互式点控制**：引入点到点映射机制，用户通过拖动控制点，可以实时调整生成图像中特定区域的特征。  
- **优化策略**：使用基于梯度下降的反向传播算法，确保拖动后的结果与用户输入的目标一致。

DragGAN的模型通过 `scripts\download_model.bat` 下载，并通过 `sh scripts/gui.sh` 提供交互式调整界面。

本实验的模型建立过程，充分利用了GAN的强大生成能力与神经网络的优化技术，确保了高质量的图像生成与用户友好的交互体验。



## 实验结果

1. **cGAN生成真实图像:**

<p align="center">
  <figure style="display: inline-block; margin: 10px;">
    <img src="pics\1.jpg" alt="语义图" width="290" height="280">
    <figcaption>图1：由语义图像生成的真实图像1。</figcaption>
  </figure>

  <figure style="display: inline-block; margin: 10px;">
    <img src="pics\2.jpg" alt="真实图像" width="290" height="280">
    <figcaption>图2：语义图像生成的真实图像2。</figcaption>
  </figure>
</p>

2. **DragGAN实现**
<img src="pics\human.gif" alt="对人的交互操作" width="600">
<img src="pics\tiger.gif" alt="对老虎的交互操作" width="600">

